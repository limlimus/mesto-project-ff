(()=>{"use strict";var t;function e(t,e,n,o,r,c,a,i){var u=c.cloneNode(!0).querySelector(".card"),s=u.querySelector(".card__image"),l=u.querySelector(".card__title"),d=u.querySelector(".card__delete-button"),p=u.querySelector(".card__like-button"),m=u.querySelector(".card__like_counter");return u.id="card-".concat(t._id),s.src=t.link,s.alt=t.name,l.textContent=t.name,m.textContent=t.likes.length,s.addEventListener("click",(function(){n(r,t)})),p.addEventListener("click",(function(){e(p,t,u)})),d.addEventListener("click",(function(){o(t)})),a||d.classList.add("card__delete-button_hidden"),i&&p.classList.add("card__like-button_is-active"),u}function n(e,n,o){var r;e.classList.toggle("card__like-button_is-active"),e.classList.contains("card__like-button_is-active")?(r=n._id,fetch("https://nomoreparties.co/v1/".concat(t.groupId,"/cards/likes/").concat(r),{method:"PUT",headers:{authorization:"".concat(t.token),"Content-Type":"application/json"}}).then((function(t){return t.ok?t.json():Promise.reject("Error ".concat(t.status))})).catch((function(t){console.log(t)}))).then((function(t){o.querySelector(".card__like_counter").textContent=t.likes.length})):function(e){return fetch("https://nomoreparties.co/v1/".concat(t.groupId,"/cards/likes/").concat(e),{method:"DELETE",headers:{authorization:"".concat(t.token),"Content-Type":"application/json"}}).then((function(t){return t.ok?t.json():Promise.reject("Error ".concat(t.status))})).catch((function(t){console.log(t)}))}(n._id).then((function(t){o.querySelector(".card__like_counter").textContent=t.likes.length}))}function o(t){t.classList.add("popup_is-opened"),document.addEventListener("keydown",c)}function r(t){t.classList.remove("popup_is-opened"),document.removeEventListener("keydown",c)}function c(t){"Escape"===t.key&&r()}function a(t){var e=document.querySelector(".popup_is-opened");t.target===e&&r(e)}var i=function(t,e,n){var o=t.querySelector(".".concat(e.id,"-error"));e.classList.remove(n.inputErrorClass),o.classList.remove(n.errorClass),o.textContent=""},u=function(t,e,n){!function(t){return t.some((function(t){return!t.validity.valid}))}(t)?(e.disabled=!1,e.classList.remove(n.inactiveButtonClass)):(e.disabled=!0,e.classList.add(n.inactiveButtonClass))},s=function(t,e){var n=Array.from(t.querySelectorAll(e.inputSelector));t.reset(),n.forEach((function(n){i(t,n,e)}))},l=document.querySelector(".places__list"),d=document.querySelector("#card-template").content,p=document.querySelectorAll(".popup"),m=document.querySelector(".popup_type_edit"),_=document.querySelector(".popup_type_new-card"),f=document.querySelector(".popup_type_image"),v=document.forms["edit-profile"],h=document.querySelector(".popup__input_type_name"),y=document.querySelector(".popup__input_type_description"),S=document.forms["new-place"],k=document.querySelector(".popup__input_type_card-name"),C=document.querySelector(".popup__input_type_url"),b=document.querySelectorAll(".popup__close"),E=document.querySelector(".profile__edit-button"),q=document.querySelector(".profile__add-button"),g=document.querySelector(".profile__title"),L=document.querySelector(".profile__description"),x=document.querySelector(".profile__image"),j=document.querySelector(".popup_type_delete-card"),P=document.forms["delete-card"],T=document.querySelector("#delete-card"),A=document.querySelector(".popup_type_new_avatar"),I=document.forms["new-avatar"],w=document.querySelector(".popup__input_type_avatar-link"),z={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"};function D(t,e){o(t);var n=t.querySelector(".popup__image"),r=t.querySelector(".popup__caption");n.src=e.link,r.textContent=e.name}function B(t){o(j),T.value=t._id}t={token:"beb4447c-03b3-4004-a487-88a53c0f8269",groupId:"wff-cohort-13"},E.addEventListener("click",(function(){o(m),s(v,z),h.value=g.textContent,y.value=L.textContent})),q.addEventListener("click",(function(){o(_),S.reset(),s(S,z)})),x.addEventListener("click",(function(){o(A),s(I,z)})),p.forEach((function(t){t.addEventListener("click",a)})),b.forEach((function(t){var e=t.closest(".popup");t.addEventListener("click",(function(){r(e)}))})),I.addEventListener("submit",(function(e){e.preventDefault();var n,o=e.submitter.textContent;e.submitter.textContent="Сохранение...",(n=w.value,fetch("https://nomoreparties.co/v1/".concat(t.groupId,"/users/me/avatar"),{method:"PATCH",headers:{authorization:"".concat(t.token),"Content-Type":"application/json"},body:JSON.stringify({avatar:n})}).then((function(t){return t.ok?t.json():Promise.reject("Error ".concat(t.status))})).catch((function(t){console.log(t)}))).then((function(t){r(A),x.style="background-image: url('".concat(t.avatar,"')"),e.submitter.textContent=o}))})),v.addEventListener("submit",(function(e){return function(e){e.preventDefault();var n,o,c=e.submitter.textContent;e.submitter.textContent="Сохранение...",(n=h.value,o=y.value,fetch("https://nomoreparties.co/v1/".concat(t.groupId,"/users/me"),{method:"PATCH",headers:{authorization:"".concat(t.token),"Content-Type":"application/json"},body:JSON.stringify({name:n,about:o})}).then((function(t){return t.ok?t.json():Promise.reject("Error ".concat(t.status))})).catch((function(t){console.log(t)}))).then((function(t){g.textContent=t.name,L.textContent=t.about,e.submitter.textContent=c,r(m)}))}(e)})),S.addEventListener("submit",(function(o){return function(e,n){e.preventDefault();var o,c,a=e.submitter.textContent;e.submitter.textContent="Сохранение...",(o=k.value,c=C.value,fetch("https://nomoreparties.co/v1/".concat(t.groupId,"/cards"),{method:"POST",headers:{authorization:"".concat(t.token),"Content-Type":"application/json"},body:JSON.stringify({name:o,link:c})}).then((function(t){return t.ok?t.json():Promise.reject("Error ".concat(t.status))})).catch((function(t){console.log(t)}))).then((function(t){n(t),e.submitter.textContent=a,r(_)}))}(o,(function(t){var o=e(t,n,D,B,f,d,!0,!1);l.prepend(o)}))})),P.addEventListener("submit",(function(e){e.preventDefault();var n,o,c=e.submitter.textContent;e.submitter.textContent="Удаление...",(n=T.value,(o=n,fetch("https://nomoreparties.co/v1/".concat(t.groupId,"/cards/").concat(o),{method:"DELETE",headers:{authorization:"".concat(t.token),"Content-Type":"application/json"}}).then((function(t){return t.ok?t.json():Promise.reject("Error")})).catch((function(t){console.log(t)}))).then((function(){r(j),document.querySelector("#card-".concat(n)).remove()}))).then((function(){e.submitter.textContent=c}))})),Promise.all([fetch("https://nomoreparties.co/v1/".concat(t.groupId,"/users/me"),{headers:{authorization:"".concat(t.token)}}).then((function(t){return t.ok?t.json():Promise.reject("Error ".concat(t.status))})).catch((function(t){console.log(t)})),fetch("https://nomoreparties.co/v1/".concat(t.groupId,"/cards"),{headers:{authorization:"".concat(t.token)}}).then((function(t){return t.ok?t.json():Promise.reject("Error ".concat(t.status))})).catch((function(t){console.log(t)}))]).then((function(t){var o=t[0];t[1].forEach((function(t){var r=o._id===t.owner._id,c=t.likes.some((function(t){return t._id===o._id})),a=e(t,n,D,B,f,d,r,c);l.append(a)})),g.textContent=o.name,L.textContent=o.about,x.style="background-image: url('".concat(o.avatar,"')")})),function(t){Array.from(document.querySelectorAll(t.formSelector)).forEach((function(e){!function(t,e){var n=Array.from(t.querySelectorAll(e.inputSelector)),o=t.querySelector(e.submitButtonSelector);u(n,o,e),n.forEach((function(r){r.addEventListener("input",(function(){!function(t,e,n){e.validity.patternMismatch?e.setCustomValidity(e.dataset.errorMessage):e.setCustomValidity(""),e.validity.valid?i(t,e,n):function(t,e,n,o){var r=t.querySelector(".".concat(e.id,"-error"));e.classList.add(o.inputErrorClass),r.textContent=n,r.classList.add(o.errorClass)}(t,e,e.validationMessage,n)}(t,r,e),u(n,o,e)}))}))}(e,t)}))}(z)})();