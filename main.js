(()=>{"use strict";var t;function e(t,e,o,n,r,c,a,i){var u=c.cloneNode(!0).querySelector(".card"),s=u.querySelector(".card__image"),l=u.querySelector(".card__title"),d=u.querySelector(".card__delete-button"),p=u.querySelector(".card__like-button"),m=u.querySelector(".card__like_counter");return u.id="card-".concat(t._id),s.src=t.link,s.alt=t.name,l.textContent=t.name,m.textContent=t.likes.length,s.addEventListener("click",(function(){o(r,t)})),p.addEventListener("click",(function(){e(p,t,u)})),d.addEventListener("click",(function(){n(u,t)})),a||d.classList.add("card__delete-button_hidden"),i&&p.classList.add("card__like-button_is-active"),u}function o(e,o,n){var r;e.classList.toggle("card__like-button_is-active"),e.classList.contains("card__like-button_is-active")?(r=o._id,fetch("https://nomoreparties.co/v1/".concat(t.groupId,"/cards/likes/").concat(r),{method:"PUT",headers:{authorization:"".concat(t.token),"Content-Type":"application/json"}}).then((function(t){return t.ok?t.json():Promise.reject("Error ".concat(t.status))})).catch((function(t){console.log(t)}))).then((function(t){n.querySelector(".card__like_counter").textContent=t.likes.length})):function(e){return fetch("https://nomoreparties.co/v1/".concat(t.groupId,"/cards/likes/").concat(e),{method:"DELETE",headers:{authorization:"".concat(t.token),"Content-Type":"application/json"}}).then((function(t){return t.ok?t.json():Promise.reject("Error ".concat(t.status))})).catch((function(t){console.log(t)}))}(o._id).then((function(t){n.querySelector(".card__like_counter").textContent=t.likes.length}))}function n(t){t.classList.add("popup_is-opened"),document.addEventListener("keydown",c)}function r(t){t.classList.remove("popup_is-opened"),document.removeEventListener("keydown",c)}function c(t){"Escape"===t.key&&r()}function a(t){var e=document.querySelector(".popup_is-opened");t.target===e&&r(e)}var i=function(t,e,o){var n=t.querySelector(".".concat(e.id,"-error"));e.classList.remove(o.inputErrorClass),n.classList.remove(o.errorClass),n.textContent=""},u=function(t,e,o){!function(t){return t.some((function(t){return!t.validity.valid}))}(t)?(e.disabled=!1,e.classList.remove(o.inactiveButtonClass)):(e.disabled=!0,e.classList.add(o.inactiveButtonClass))},s=function(t,e){var o=Array.from(t.querySelectorAll(e.inputSelector));t.reset(),o.forEach((function(o){i(t,o,e)}))},l=document.querySelector(".places__list"),d=document.querySelector("#card-template").content,p=document.querySelectorAll(".popup"),m=document.querySelector(".popup_type_edit"),_=document.querySelector(".popup_type_new-card"),f=document.querySelector(".popup_type_image"),v=document.forms["edit-profile"],y=document.querySelector(".popup__input_type_name"),h=document.querySelector(".popup__input_type_description"),S=document.forms["new-place"],k=document.querySelector(".popup__input_type_card-name"),C=document.querySelector(".popup__input_type_url"),b=document.querySelectorAll(".popup__close"),E=document.querySelector(".profile__edit-button"),q=document.querySelector(".profile__add-button"),g=document.querySelector(".profile__title"),L=document.querySelector(".profile__description"),j=document.querySelector(".profile__image"),x=document.querySelector(".popup_type_delete-card"),P=document.forms["delete-card"],T=document.querySelector("#delete-card"),A=document.querySelector(".popup_type_new_avatar"),I=document.forms["new-avatar"],w=document.querySelector(".popup__input_type_avatar-link"),z={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"};function D(t,e){n(t);var o=t.querySelector(".popup__image"),r=t.querySelector(".popup__caption");o.src=e.link,r.textContent=e.name}function B(t){n(x),T.value=t._id}t={token:"beb4447c-03b3-4004-a487-88a53c0f8269",groupId:"wff-cohort-13"},E.addEventListener("click",(function(){n(m),s(v,z),y.value=g.textContent,h.value=L.textContent})),q.addEventListener("click",(function(){n(_),S.reset(),s(S,z)})),j.addEventListener("click",(function(){n(A),s(I,z)})),p.forEach((function(t){t.addEventListener("click",a)})),b.forEach((function(t){var e=t.closest(".popup");t.addEventListener("click",(function(){r(e)}))})),I.addEventListener("submit",(function(e){e.preventDefault();var o,n=e.submitter.textContent;e.submitter.textContent="Сохранение...",(o=w.value,fetch("https://nomoreparties.co/v1/".concat(t.groupId,"/users/me/avatar"),{method:"PATCH",headers:{authorization:"".concat(t.token),"Content-Type":"application/json"},body:JSON.stringify({avatar:o})}).then((function(t){return t.ok?t.json():Promise.reject("Error ".concat(t.status))})).catch((function(t){console.log(t)}))).then((function(t){r(A),j.style="background-image: url('".concat(t.avatar,"')"),e.submitter.textContent=n}))})),v.addEventListener("submit",(function(e){return function(e){e.preventDefault();var o,n,c=e.submitter.textContent;e.submitter.textContent="Сохранение...",(o=y.value,n=h.value,fetch("https://nomoreparties.co/v1/".concat(t.groupId,"/users/me"),{method:"PATCH",headers:{authorization:"".concat(t.token),"Content-Type":"application/json"},body:JSON.stringify({name:o,about:n})}).then((function(t){return t.ok?t.json():Promise.reject("Error ".concat(t.status))})).catch((function(t){console.log(t)}))).then((function(t){g.textContent=t.name,L.textContent=t.about,e.submitter.textContent=c,r(m)}))}(e)})),S.addEventListener("submit",(function(n){return function(e,o){e.preventDefault();var n,c,a=e.submitter.textContent;e.submitter.textContent="Сохранение...",(n=k.value,c=C.value,fetch("https://nomoreparties.co/v1/".concat(t.groupId,"/cards"),{method:"POST",headers:{authorization:"".concat(t.token),"Content-Type":"application/json"},body:JSON.stringify({name:n,link:c})}).then((function(t){return t.ok?t.json():Promise.reject("Error ".concat(t.status))})).catch((function(t){console.log(t)}))).then((function(t){o(t),e.submitter.textContent=a,r(_)}))}(n,(function(t){var n=e(t,o,D,B,f,d,!0,!1);l.prepend(n)}))})),P.addEventListener("submit",(function(e){e.preventDefault();var o,n=T.value;(o=n,fetch("https://nomoreparties.co/v1/".concat(t.groupId,"/cards/").concat(o),{method:"DELETE",headers:{authorization:"".concat(t.token),"Content-Type":"application/json"}}).then((function(t){return t.ok?t.json():Promise.reject("Error")})).catch((function(t){console.log(t)}))).then((function(){r(x),document.querySelector("#card-".concat(n)).remove()}))})),Promise.all([fetch("https://nomoreparties.co/v1/".concat(t.groupId,"/users/me"),{headers:{authorization:"".concat(t.token)}}).then((function(t){return t.ok?t.json():Promise.reject("Error ".concat(t.status))})).catch((function(t){console.log(t)})),fetch("https://nomoreparties.co/v1/".concat(t.groupId,"/cards"),{headers:{authorization:"".concat(t.token)}}).then((function(t){return t.ok?t.json():Promise.reject("Error ".concat(t.status))})).catch((function(t){console.log(t)}))]).then((function(t){var n=t[0];t[1].forEach((function(t){var r=n._id===t.owner._id,c=t.likes.some((function(t){return t._id===n._id})),a=e(t,o,D,B,f,d,r,c);l.append(a)})),g.textContent=n.name,L.textContent=n.about,j.style="background-image: url('".concat(n.avatar,"')")})),function(t){Array.from(document.querySelectorAll(t.formSelector)).forEach((function(e){!function(t,e){var o=Array.from(t.querySelectorAll(e.inputSelector)),n=t.querySelector(e.submitButtonSelector);u(o,n,e),o.forEach((function(r){r.addEventListener("input",(function(){!function(t,e,o){e.validity.patternMismatch?e.setCustomValidity(e.dataset.errorMessage):e.setCustomValidity(""),e.validity.valid?i(t,e,o):function(t,e,o,n){var r=t.querySelector(".".concat(e.id,"-error"));e.classList.add(n.inputErrorClass),r.textContent=o,r.classList.add(n.errorClass)}(t,e,e.validationMessage,o)}(t,r,e),u(o,n,e)}))}))}(e,t)}))}(z)})();